<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elderly Care System - Connect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom theme colors - Peach Palette */
        :root {
            --theme-primary: #78350f; /* Dark Brown (amber-900) - Main text, some accents */
            --theme-primary-dark: #57250a; /* Darkest Brown */
            --theme-secondary: #a8a29e; /* Neutral Gray/Stone (stone-400) - Borders, sub-headings */
            --theme-secondary-dark: #78716c; /* Darker Stone (stone-500) */
            /* Peach Accent */
            --theme-accent: #fb923c; /* Peach (orange-400) - Buttons, links, highlights */
            --theme-accent-dark: #f97316; /* Darker Peach (orange-500) */
            --theme-bg-light: #fffbeb; /* Very Light Beige/Yellow (yellow-100) - Body background */
            --theme-bg-card: #ffffff; /* White - Card/Section background */
            --theme-bg-sidebar: #fefce8; /* Slightly different beige for sidebar (yellow-50) */
            --theme-text-dark: #3f3f46; /* Dark Gray (zinc-700) - Body text */
            --theme-text-medium: #71717a; /* Medium Gray (zinc-500) - Secondary text */
            --theme-text-light: #f4f4f5; /* zinc-100 - Text on dark buttons */
            --theme-text-white: #ffffff;
            --theme-border: #e7e5e4; /* Light Gray Border (stone-200) */
            --theme-border-dark: #d6d3d1; /* Darker Gray Border (stone-300) */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--theme-bg-light);
            color: var(--theme-text-dark);
            line-height: 1.6;
        }

        /* Header Styling */
        .header { background-color: var(--theme-bg-sidebar); color: var(--theme-primary); padding: 0.8rem 2rem; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; border-bottom: 2px solid var(--theme-border); box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); }
        .header .logo { flex-shrink: 0; }
        .header h1 { font-size: 1.7rem; font-weight: 600; letter-spacing: 0.5px; color: var(--theme-primary); }
        .header .logo i { margin-right: 0.6rem; color: var(--theme-accent); }
        .nav-links { display: flex; align-items: center; flex-wrap: wrap; margin-top: 0.5rem; flex-grow: 1; justify-content: flex-end; }
        .nav-links a, .nav-links span { color: var(--theme-primary); margin: 0.3rem 0.8rem; text-decoration: none; transition: color 0.3s ease, transform 0.2s ease; font-weight: 500; position: relative; padding-bottom: 4px; white-space: nowrap; }
        .nav-links span { margin-right: 0.5rem; }
        .nav-links a::after { content: ''; position: absolute; width: 0; height: 2px; bottom: 0; left: 0; background-color: var(--theme-accent); transition: width 0.3s ease; }
        .nav-links a:hover { color: var(--theme-accent); transform: translateY(-1px); }
        .nav-links a:hover::after { width: 100%; }
        .nav-links .login-button, .nav-links .logout-button { display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1.2rem; border-radius: 6px; font-weight: 500; text-align: center; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; background-color: var(--theme-accent); color: var(--theme-text-white); border: none; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); margin: 0.3rem 0 0.3rem 0.8rem; font-size: 0.95rem; white-space: nowrap; }
        .nav-links .login-button i, .nav-links .logout-button i { margin-right: 0.5rem; font-size: 0.9em; }
        .nav-links .login-button:hover, .nav-links .logout-button:hover { background-color: var(--theme-accent-dark); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); color: var(--theme-text-white); }
        .nav-links .login-button::after, .nav-links .logout-button::after { display: none; }
        .nav-links .logout-link { color: var(--theme-accent); font-weight: 500; margin-left: 0.8rem; cursor: pointer; }
        .nav-links .logout-link:hover { color: var(--theme-accent-dark); text-decoration: underline; }

        /* Hero Section Styling */
        .hero-section { background: linear-gradient(rgba(255, 251, 235, 0.6), rgba(255, 251, 235, 0.6)), url('https://media.istockphoto.com/id/1387431877/photo/female-care-worker-in-uniform-helping-senior-woman-at-home-in-bed-with-medication.jpg?s=612x612&w=0&k=20&c=IUvjINlj2q1aNU6rpufmF1Hb1jcCbG-KUAzyBE9er5U='); background-size: cover; background-position: center; padding: 6rem 2rem; text-align: center; color: var(--theme-primary); border-bottom: 1px solid var(--theme-border); background-color: #fffbeb; }
        .hero-section h2 { font-size: 2.6rem; font-weight: 700; margin-bottom: 1rem; line-height: 1.2; color: var(--theme-primary-dark); text-shadow: 1px 1px 2px rgba(255,255,255,0.5); }
        .hero-section p { font-size: 1.15rem; color: var(--theme-text-dark); max-width: 700px; margin: 0 auto 2.5rem auto; line-height: 1.7; font-weight: 500; text-shadow: 1px 1px 2px rgba(255,255,255,0.3); }
        .hero-section .btn { padding: 0.9rem 2.2rem; font-size: 1.05rem; margin-top: 1rem; background-color: var(--theme-accent); color: var(--theme-text-white); box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); align-self: center; }
        .hero-section .btn:hover { background-color: var(--theme-accent-dark); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); transform: translateY(-2px); }

        /* Main Content Area - Two Column Layout */
        .main-content-wrapper { padding: 2.5rem; display: grid; grid-template-columns: 2fr 1fr; gap: 2.5rem; }
        .main-column { display: flex; flex-direction: column; gap: 2.5rem; }
        .sidebar-column { background-color: var(--theme-bg-sidebar); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--theme-border); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column; gap: 2rem; align-self: start; }

        /* Individual content sections */
        .content-section { background-color: var(--theme-bg-card); padding: 2rem; border-radius: 8px; border: 1px solid var(--theme-border); box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07); }
        .sidebar-column .content-section { background-color: transparent; padding: 0; border: none; box-shadow: none; border-bottom: 1px dashed var(--theme-border-dark); }
        .sidebar-column .content-section:last-child { border-bottom: none; }

        .content-section .section-image { width: 100%; height: 200px; object-fit: cover; display: block; background-color: var(--theme-bg-light); margin-bottom: 1.5rem; border-radius: 6px; border: 1px solid var(--theme-border); }
        .content-section .section-image:error { display: flex; align-items: center; justify-content: center; color: var(--theme-text-medium); font-size: 0.9rem; border-radius: 6px; border: 1px solid var(--theme-border); }
        .content-section .section-image:error::after { content: 'Image unavailable'; font-style: italic; }

        .content-section h2 { font-size: 1.3rem; font-weight: 600; color: var(--theme-primary); margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--theme-secondary); display: inline-flex; align-items: center; }
        .sidebar-column .content-section h2 { font-size: 1.15rem; border-bottom-width: 1px; }
        .content-section h2 i { margin-right: 0.8rem; color: var(--theme-secondary); width: 20px; text-align: center; }

        .content-section p, .content-section ul { color: var(--theme-text-dark); font-size: 0.95rem; line-height: 1.7; margin-bottom: 1rem; }
        .content-section p:last-child, .content-section ul:last-child { margin-bottom: 0; }
        .content-section ul { list-style: none; padding-left: 0; }
        .content-section li { margin-bottom: 0.6rem; display: flex; align-items: center; }
        .content-section li i { margin-right: 0.6rem; color: var(--theme-secondary); width: 16px; flex-shrink: 0; text-align: center; }

        /* Notification Badge */
        .notification-badge { background-color: var(--theme-accent); color: var(--theme-text-white); border-radius: 10px; padding: 0.25rem 0.6rem; font-size: 0.75rem; font-weight: 600; margin-left: 0.7rem; vertical-align: middle; }

        /* Footer Styling */
        .footer { background-color: #fdfbf5; color: var(--theme-text-medium); text-align: center; padding: 2rem; margin-top: 3rem; border-top: 1px solid var(--theme-border); }
        .footer p { margin-bottom: 0.7rem; }
        .footer a { color: var(--theme-accent); text-decoration: none; transition: color 0.3s ease; }
        .footer a:hover { color: var(--theme-accent-dark); text-decoration: underline; }

        /* Responsive Adjustments */
        @media (max-width: 992px) {
            .main-content-wrapper { grid-template-columns: 1fr; padding: 2rem 1.5rem; gap: 2rem; }
            .sidebar-column { background-color: transparent; padding: 0; border: none; box-shadow: none; gap: 2rem; }
            .sidebar-column .content-section { border-bottom: 1px solid var(--theme-border); }
            .sidebar-column .content-section:last-child { border-bottom: none; }
        }
        @media (max-width: 768px) {
             .header { align-items: center; }
             .header .logo { text-align: left; margin-bottom: 0; margin-right: auto; }
             .header h1 { font-size: 1.6rem; }
             .nav-links { margin-top: 0; justify-content: flex-end; width: auto; flex-grow: 0; }
             .nav-links a, .nav-links button { margin: 0.3rem 0 0.3rem 1rem; }
             .hero-section { padding: 4rem 1rem; min-height: 40vh; }
             .hero-section h2 { font-size: 1.8rem; }
             .hero-section p { font-size: 1rem; }
             .main-content-wrapper { padding: 2rem 1rem; }
             .content-section { padding: 1.5rem; }
             .content-section h2 { font-size: 1.2rem; }
             .content-section .section-image { height: 160px; }
        }

        /* Button Style */
        .btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.7rem 1.5rem; border-radius: 6px; font-weight: 500; text-align: center; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; margin-top: 1rem; background-color: var(--theme-accent); color: var(--theme-text-white); border: none; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); align-self: flex-start; }
        .hero-section .btn { align-self: center; }
        .content-section .btn { margin-top: 1.5rem; }
        .btn i { margin-right: 0.6rem; font-size: 0.9em; }
        .btn:hover { background-color: var(--theme-accent-dark); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); }

        /* Health Tracking Specifics */
        .health-stat { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.7rem; padding-bottom: 0.7rem; border-bottom: 1px dashed var(--theme-border); }
        .health-stat:last-child { border-bottom: none; margin-bottom: 0; }
        .health-stat span:first-child { font-weight: 500; color: var(--theme-text-dark); }
        .health-stat span:last-child { font-weight: 600; color: var(--theme-primary); background-color: transparent; padding: 0; border-radius: 0; }

        /* Meal Spec Specifics */
        .meal-category { margin-bottom: 1.2rem; }
        .meal-category h3 { font-weight: 600; color: var(--theme-secondary); margin-bottom: 0.5rem; font-size: 1rem; border-left: none; padding-left: 0; }
        .meal-category ul { padding-left: 0; list-style: none; }
        .meal-category li { margin-bottom: 0.3rem; color: var(--theme-text-medium); align-items: flex-start; position: relative; padding-left: 1.2rem; }
        .meal-category li::before { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--theme-accent); display: inline-block; position: absolute; left: 0; top: 5px; font-size: 0.75em; }
        .meal-category li i { display: none; }

        /* Login Modal Styles */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(40, 40, 42, 0.6); justify-content: center; align-items: center; }
        .modal-content { background-color: #ffffff; margin: auto; padding: 2.5rem; border: 1px solid var(--theme-border-dark); border-radius: 8px; width: 90%; max-width: 450px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15); position: relative; color: var(--theme-text-dark); }
        .modal-content h2 { color: var(--theme-primary); text-align: center; margin-bottom: 1rem; font-size: 1.6rem; }
        .modal-close { color: var(--theme-text-medium); position: absolute; top: 1rem; right: 1.5rem; font-size: 1.8rem; font-weight: bold; transition: color 0.3s ease; line-height: 1; }
        .modal-close:hover, .modal-close:focus { color: var(--theme-text-dark); text-decoration: none; cursor: pointer; }

        /* Form Styling */
        .form-group { margin-bottom: 1.2rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--theme-text-dark); }
        .form-group input, .form-group select { width: 100%; padding: 0.8rem 1rem; border-radius: 6px; border: 1px solid var(--theme-border-dark); background-color: var(--theme-bg-light); color: var(--theme-text-dark); font-size: 1rem; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--theme-accent); box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.2); }
        .form-group select { appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2371717a%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 0.65em auto; padding-right: 2.5rem; }
        .modal .btn { width: 100%; margin-top: 1rem; padding: 0.9rem 1.8rem; font-size: 1.1rem; color: var(--theme-text-white); }

        /* Modal view switching */
        #registerView { display: none; }
        .modal-switch { text-align: center; margin-top: 1.5rem; font-size: 0.9rem; }
        .modal-switch a { color: var(--theme-accent); cursor: pointer; text-decoration: underline; }
        .modal-switch a:hover { color: var(--theme-accent-dark); }

        /* Styles for Caregiver Patient List */
        .patient-list-section { background-color: var(--theme-bg-card); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--theme-border); box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07); margin-bottom: 2rem; }
        .patient-list-section h2 { color: var(--theme-primary); font-size: 1.4rem; font-weight: 600; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--theme-secondary); }
        .patient-list ul { list-style: none; padding: 0; margin: 0; }
        .patient-list li { padding: 0.75rem 0.5rem; border-bottom: 1px solid var(--theme-border); cursor: pointer; transition: background-color 0.2s ease; }
        .patient-list li:last-child { border-bottom: none; }
        .patient-list li:hover { background-color: var(--theme-bg-sidebar); }
        .patient-list li i { margin-right: 0.75rem; color: var(--theme-secondary); }
        .patient-list .selected-patient { background-color: var(--theme-accent-dark); color: var(--theme-text-white); font-weight: 600; }
        .patient-list .selected-patient i { color: var(--theme-text-white); }

        /* Patient data sections */
        .patient-data-section { /* No initial hiding for now */ }

        /* Health Record Input Form Specific Styles */
        #healthRecordForm { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--theme-border); }
        #healthRecordForm h3 { font-size: 1.1rem; font-weight: 600; color: var(--theme-primary); margin-bottom: 1rem; }
        #healthRecordForm .form-row { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; }
        #healthRecordForm .form-row .form-group { flex: 1; min-width: 120px; margin-bottom: 0; }
        #healthRecordForm .form-row .form-group label { font-size: 0.9rem; margin-bottom: 0.25rem; }

    </style>
</head>
<body>

    <header class="header">
        <div class="logo">
            <h1><i class="fas fa-hands-helping"></i>Elderly Care Connect</h1>
        </div>
        <nav class="nav-links">
            <a href="#dashboard">Dashboard</a>
            <a href="#health">Health</a>
            <a href="#meals">Meals</a>
            <a href="#contact">Contact</a>
            <a href="#resources">Resources</a>

            {% if username %}
                <span>Welcome, {{ username }}!</span>
                <a href="/logout" class="logout-link" style="text-decoration: none;">
                     <button class="logout-button" style="background-color: var(--theme-secondary-dark); padding: 0.5rem 1rem;"> <i class="fas fa-sign-out-alt"></i> Logout
                     </button>
                </a>
            {% else %}
                <button id="loginBtn" class="login-button"><i class="fas fa-sign-in-alt"></i> Login</button>
            {% endif %}
            </nav>
    </header>

    <section class="hero-section">
        <h2>Compassionate Care for Your Loved Ones</h2>
        <p>Providing reliable and personalized elderly care services in Nairobi. We ensure comfort, safety, and well-being for seniors in their own homes.</p>
        <button class="btn">
            <i class="fas fa-info-circle"></i> Learn More About Our Services
        </button>
    </section>

    <div class="main-content-wrapper" id="dashboard">

        <div class="main-column">

            {% if username and role == 'caregiver' %} {# Show patient list only for caregivers #}
            <div id="patientListSection" class="patient-list-section">
                <h2><i class="fas fa-users"></i> Assigned Patients</h2>
                <p id="patient-loading-message" style="display: none;">Loading patients...</p>
                <ul id="patientList" class="patient-list">
                    </ul>
            </div>
            {% endif %}

            <div class="content-section patient-data-section" id="health">
                 <img src="https://placehold.co/600x200/ffffff/854d0e?text=Health+Graph" alt="Abstract health graph"
                      class="section-image"
                      onerror="this.style.display='none'; this.onerror=null;">
                 <h2><i class="fas fa-heart-pulse"></i>Health Tracking <span id="health-patient-name" style="font-weight: normal; color: var(--theme-secondary); margin-left: 10px;"></span></h2>
                 <div id="health-stats-container">
                     <div class="health-stat">
                         <span>Blood Pressure:</span>
                         <span id="health-bp">--/-- mmHg</span>
                     </div>
                     <div class="health-stat">
                         <span>Blood Sugar (Fasting):</span>
                         <span id="health-sugar">-- mg/dL</span>
                     </div>
                      <div class="health-stat">
                         <span>Heart Rate:</span>
                         <span id="health-hr">-- bpm</span>
                     </div>
                 </div>
                 <p id="health-last-updated" style="margin-top: 1rem; margin-bottom: 1.5rem; font-size: 0.85rem; color: var(--theme-text-medium);">Last updated: --</p>
                 <p id="health-no-data" style="color: var(--theme-text-medium); display: none;">No health data available for selected patient.</p>
                 <button class="btn">
                     <i class="fas fa-chart-line"></i>View Detailed Report
                 </button>

                 {% if username %} {# Only show form if logged in #}
                 <form id="healthRecordForm">
                     <h3><i class="fas fa-plus-circle"></i> Add New Health Reading</h3>
                     <div class="form-row">
                         <div class="form-group">
                             <label for="record_type">Reading Type</label>
                             <select id="record_type" name="record_type" required>
                                 <option value="">Select Type...</option>
                                 <option value="Blood Pressure">Blood Pressure</option>
                                 <option value="Blood Sugar">Blood Sugar</option>
                                 <option value="Heart Rate">Heart Rate</option>
                                 <option value="Weight">Weight</option>
                                 <option value="Temperature">Temperature</option>
                                 <option value="Other">Other</option>
                             </select>
                         </div>
                          <div class="form-group">
                             <label for="value1">Value 1 (or Systolic)</label>
                             <input type="text" id="value1" name="value1" required>
                         </div>
                          <div class="form-group">
                             <label for="value2">Value 2 (or Diastolic)</label>
                             <input type="text" id="value2" name="value2">
                         </div>
                          <div class="form-group">
                             <label for="unit">Unit</label>
                             <input type="text" id="unit" name="unit" placeholder="e.g., mmHg, mg/dL, bpm, kg, °C">
                         </div>
                     </div>
                     <button type="submit" class="btn">
                         <i class="fas fa-save"></i> Save Reading
                     </button>
                      <p id="health-record-status" style="margin-top: 1rem; font-size: 0.9rem;"></p>
                 </form>
                 {% endif %}
                 </div>

            <div class="content-section patient-data-section" id="meals">
                 <img src="https://placehold.co/600x200/ffffff/a16207?text=Healthy+Meal" alt="Healthy meal ingredients"
                      class="section-image"
                      onerror="this.style.display='none'; this.onerror=null;">
                 <h2><i class="fas fa-utensils"></i>Today's Meal Plan <span id="meal-patient-name" style="font-weight: normal; color: var(--theme-secondary); margin-left: 10px;"></span></h2>
                 <p id="meal-plan-desc">Based on patient's health profile.</p>
                 <div id="meal-plan-container">
                     <div class="meal-category">
                         <h3>Breakfast</h3>
                         <ul id="meal-breakfast"><li>Loading...</li></ul>
                     </div>
                      <div class="meal-category">
                         <h3>Lunch</h3>
                         <ul id="meal-lunch"><li>Loading...</li></ul>
                     </div>
                      <div class="meal-category">
                         <h3>Dinner</h3>
                         <ul id="meal-dinner"><li>Loading...</li></ul>
                     </div>
                 </div>
                  <p id="meal-no-data" style="color: var(--theme-text-medium); display: none;">No meal plan available for selected patient.</p>
                 <button class="btn">
                     <i class="fas fa-edit"></i>Customize Plan
                 </button>
            </div>

             <div class="content-section" id="medications">
                 <h2><i class="fas fa-pills"></i> Medication Management</h2>
                 <p>This section will allow viewing and managing medications.</p>
                 <ul id="medication-list">
                     <li>(Medication list feature coming soon)</li>
                 </ul>
             </div>
             </div>

        <div class="sidebar-column">
            <div class="content-section">
                 <h2><i class="fas fa-tachometer-alt"></i>
                     {% if username %}
                         Welcome, {{ username }}!
                     {% else %}
                         Welcome!
                     {% endif %}
                 </h2>
                 {% if role == 'patient' and assigned_caregiver %}
                 <p style="margin-top: 0.5rem; font-size: 0.9rem;">Your assigned caregiver: <strong>{{ assigned_caregiver }}</strong></p>
                 {% endif %}
                 {% if role == 'caregiver' %}
                 <p>Select a patient from the list to view their details.</p>
                 {% elif role == 'patient' %}
                 <p>This is your personal health dashboard.</p>
                 {% else %}
                 <p>Please log in to view dashboard details.</p>
                 {% endif %}
                 </div>

            <div class="content-section">
                <h2>
                    <i class="fas fa-bell fa-shake" style="--fa-animation-duration: 2s;"></i> Notifications <span id="noti-patient-name" style="font-weight: normal; color: var(--theme-secondary); margin-left: 10px;"></span>
                    <span id="notification-count-badge" class="notification-badge">?</span>
                </h2>
                <ul id="notification-list">
                    <li>Loading notifications...</li>
                </ul>
                 <p id="noti-no-data" style="color: var(--theme-text-medium); display: none;">No notifications.</p>
                <button class="btn">
                    <i class="fas fa-arrow-right"></i>View All Notifications
                </button>
            </div>

            <div class="content-section" id="contact">
                 <h2><i class="fas fa-address-book"></i>Contact Information</h2>
                 <ul>
                     <li><i class="fas fa-envelope"></i> Email: <a href="mailto:karinanjuguna254@gmail.com" style="color: var(--theme-accent);">karinanjuguna254@gmail.com</a></li>
                     <li><i class="fas fa-phone"></i> Phone: <a href="tel:0706505498" style="color: var(--theme-accent);">0706505498</a></li>
                     <li><i class="fas fa-map-marker-alt"></i> Location: Nairobi, Kenya</li>
                 </ul>
                  <p style="margin-top: 1rem;">Feel free to reach out for support or inquiries.</p>
            </div>

             <div class="content-section" id="resources">
                 <h2><i class="fas fa-info-circle"></i> Helpful Resources</h2>
                 <p>Links to health articles, emergency contacts, or community resources could go here.</p>
                  <button class="btn">
                     <i class="fas fa-external-link-alt"></i>Explore Resources
                  </button>
            </div>
        </div>

    </div> <footer class="footer">
        <p>&copy; 2025 Elderly Care Connect. All rights reserved.</p>
        <p>Designed with care to support our seniors in Nairobi.</p>
        <p>
            <a href="#dashboard">Home</a> |
            <a href="#contact">Contact Us</a> |
            <a href="#">Privacy Policy</a>
        </p>
    </footer>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" id="closeModalBtn">&times;</span>
            <div id="loginView">
                <h2>Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="login-username">Username or Email</label>
                        <input type="text" id="login-username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" name="password" required>
                    </div>
                    <button type="submit" class="btn"><i class="fas fa-sign-in-alt"></i> Login</button>
                </form>
                <p class="modal-switch">Don't have an account? <a id="showRegisterLink">Register here</a></p>
            </div>
            <div id="registerView" style="display: none;">
                 <h2>Register</h2>
                 <form id="registerForm">
                     <div class="form-group">
                         <label for="register-username">Username</label>
                         <input type="text" id="register-username" name="username" required>
                     </div>
                     <div class="form-group">
                         <label for="register-password">Password</label>
                         <input type="password" id="register-password" name="password" required>
                     </div>
                     <div class="form-group">
                         <label for="register-role">Register As:</label>
                         <select id="register-role" name="role">
                             <option value="patient" selected>Patient/Family</option>
                             <option value="caregiver">Caregiver</option>
                             </select>
                     </div>
                     <button type="submit" class="btn"><i class="fas fa-user-plus"></i> Register</button>
                 </form>
                 <p class="modal-switch">Already have an account? <a id="showLoginLink">Login here</a></p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Elderly Care Website Frontend Loaded (v21 - Health Input & Placeholders)");

            // --- Global Variables ---
            const currentUserRole = "{{ role or 'guest' }}";
            const loggedInUsername = "{{ username or '' }}";
            const assignedCaregiverName = "{{ assigned_caregiver or '' }}";
            let currentPatientId = null; // Track selected patient for caregiver

            // --- Element References ---
            const authModal = document.getElementById('authModal');
            const loginView = document.getElementById('loginView');
            const registerView = document.getElementById('registerView');
            const showRegisterLink = document.getElementById('showRegisterLink');
            const showLoginLink = document.getElementById('showLoginLink');
            const loginBtn = document.getElementById('loginBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const patientListSection = document.getElementById('patientListSection');
            const patientListUL = document.getElementById('patientList');
            const patientLoadingMsg = document.getElementById('patient-loading-message');
            const patientDataSections = document.querySelectorAll('.patient-data-section');
            const healthRecordForm = document.getElementById('healthRecordForm');
            const healthRecordStatus = document.getElementById('health-record-status');

            // Data display elements
            const healthPatientName = document.getElementById('health-patient-name');
            const mealPatientName = document.getElementById('meal-patient-name');
            const notiPatientName = document.getElementById('noti-patient-name');
            const healthStatsContainer = document.getElementById('health-stats-container');
            const healthNoData = document.getElementById('health-no-data');
            const healthBP = document.getElementById('health-bp');
            const healthSugar = document.getElementById('health-sugar');
            const healthHR = document.getElementById('health-hr');
            const healthLastUpdated = document.getElementById('health-last-updated');
            const mealPlanContainer = document.getElementById('meal-plan-container');
            const mealNoData = document.getElementById('meal-no-data');
            const mealBreakfast = document.getElementById('meal-breakfast');
            const mealLunch = document.getElementById('meal-lunch');
            const mealDinner = document.getElementById('meal-dinner');
            const notificationList = document.getElementById('notification-list');
            const notiNoData = document.getElementById('noti-no-data');
            const notificationCountBadge = document.getElementById('notification-count-badge');


            // --- Functions ---

            // Fetch assigned patients (simulated)
            async function fetchAssignedPatients() {
                 if (!patientListUL || !patientLoadingMsg) return;
                 console.log("Fetching assigned patients...");
                 patientLoadingMsg.style.display = 'block';
                 patientListUL.innerHTML = '';
                 try {
                     // ** Replace with real fetch later: const response = await fetch('/api/my-patients'); **
                     await new Promise(resolve => setTimeout(resolve, 700));
                     // Simulate getting data from backend
                     const response = await fetch('/api/my-patients'); // Use placeholder API
                     if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                     const patients = await response.json();
                     displayPatientList(patients);
                 } catch (error) {
                     console.error("Error fetching patients:", error);
                     patientListUL.innerHTML = '<li style="color: red;">Could not load patients.</li>';
                 } finally {
                     patientLoadingMsg.style.display = 'none';
                 }
            }

            // Display patient list
            function displayPatientList(patients) {
                 if (!patientListUL) return;
                 patientListUL.innerHTML = '';
                 if (patients && patients.length > 0) {
                     patients.forEach(patient => {
                         const li = document.createElement('li');
                         li.dataset.patientId = patient.id;
                         li.dataset.patientName = patient.name;
                         li.innerHTML = `<i class="fas fa-user-circle"></i> ${patient.name}`;
                         li.addEventListener('click', handlePatientSelection);
                         patientListUL.appendChild(li);
                     });
                 } else {
                     patientListUL.innerHTML = '<li>No patients assigned.</li>';
                 }
            }

            // Handle patient selection
            function handlePatientSelection(event) {
                const selectedLi = event.currentTarget;
                currentPatientId = selectedLi.dataset.patientId; // Store selected patient ID
                const patientName = selectedLi.dataset.patientName;

                console.log(`Patient selected: ID=${currentPatientId}, Name=${patientName}`);
                document.querySelectorAll('#patientList li').forEach(li => li.classList.remove('selected-patient'));
                selectedLi.classList.add('selected-patient');
                if(healthPatientName) healthPatientName.textContent = `- ${patientName}`;
                if(mealPatientName) mealPatientName.textContent = `- ${patientName}`;
                if(notiPatientName) notiPatientName.textContent = `- ${patientName}`;
                fetchAndDisplayPatientData(currentPatientId);
                patientDataSections.forEach(section => section.style.display = 'block');
            }

             // Fetch and display data for a specific patient (simulated)
            async function fetchAndDisplayPatientData(patientId) {
                let targetPatientId = patientId; // Use the passed ID if available

                if (!targetPatientId && currentUserRole === 'patient') {
                    // If patient is logged in and no specific ID is passed, fetch their own data
                    console.log("Fetching data for logged-in patient...");
                    // In a real app, you'd get the logged-in user's ID from a secure source,
                    // but for simulation we might need to hardcode or fetch it separately.
                    // For now, we'll use a placeholder/simulated ID for the patient view
                    targetPatientId = '101'; // Simulate patient Alice's ID
                } else if (!targetPatientId && currentUserRole === 'caregiver') {
                     console.log("No patient selected by caregiver.");
                     // Hide or clear data sections when no patient is selected
                     patientDataSections.forEach(section => section.style.display = 'none');
                     return; // Stop execution if no patient is selected by caregiver
                } else if (!targetPatientId) {
                     console.log("No patient ID available.");
                     return; // Stop if no ID is available
                }


                console.log(`Fetching data for patient ID: ${targetPatientId}`);
                updateHealthUI(null, true); updateMealsUI(null, true); updateNotificationsUI(null, true);
                try {
                     // ** Replace with real fetch later: const response = await fetch(`/api/patient/${targetPatientId}/dashboard-data`); **
                     // Simulate getting data from backend
                     const response = await fetch(`/api/patient/${targetPatientId}/dashboard-data`); // Use placeholder API
                     if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                     const data = await response.json();
                     updateHealthUI(data.health);
                     updateMealsUI(data.meals);
                     updateNotificationsUI(data.notifications); // Assuming notifications are patient-specific
                } catch (error) {
                    console.error("Error fetching patient data:", error);
                    updateHealthUI(null, false, true); updateMealsUI(null, false, true); updateNotificationsUI(null, false, true);
                }
            }

            // Update Health Section UI
            function updateHealthUI(healthData, isLoading = false, isError = false) {
                 if (!healthStatsContainer || !healthNoData || !healthBP || !healthSugar || !healthHR || !healthLastUpdated) return;
                 healthNoData.style.display = 'none'; healthStatsContainer.style.display = 'none';
                 if (isLoading) { healthStatsContainer.style.display = 'block'; healthBP.textContent = 'Loading...'; healthSugar.textContent = 'Loading...'; healthHR.textContent = 'Loading...'; healthLastUpdated.textContent = 'Loading...'; }
                 else if (isError) { healthNoData.textContent = 'Error loading health data.'; healthNoData.style.display = 'block'; }
                 else if (healthData && Object.keys(healthData).length > 0) { // Check if healthData is not empty
                     healthStatsContainer.style.display = 'block';
                     healthBP.textContent = healthData.bp || '--/-- mmHg';
                     healthSugar.textContent = healthData.sugar || '-- mg/dL';
                     healthHR.textContent = healthData.hr || '-- bpm';
                     healthLastUpdated.textContent = `Last updated: ${healthData.updated || '--'}`;
                 } else {
                     healthNoData.textContent = 'No health data available.';
                     healthNoData.style.display = 'block';
                 }
            }

            // Update Meal Section UI
            function updateMealsUI(mealData, isLoading = false, isError = false) {
                 if (!mealPlanContainer || !mealNoData || !mealBreakfast || !mealLunch || !mealDinner) return;
                 mealNoData.style.display = 'none'; mealPlanContainer.style.display = 'none';
                 if (isLoading) { mealPlanContainer.style.display = 'block'; mealBreakfast.innerHTML = '<li>Loading...</li>'; mealLunch.innerHTML = '<li>Loading...</li>'; mealDinner.innerHTML = '<li>Loading...</li>'; }
                 else if (isError) { mealNoData.textContent = 'Error loading meal plan.'; mealNoData.style.display = 'block'; }
                 else if (mealData && (mealData.breakfast?.length || mealData.lunch?.length || mealData.dinner?.length)) { // Check if mealData has content
                    mealPlanContainer.style.display = 'block';
                    mealBreakfast.innerHTML = mealData.breakfast?.map(item => `<li>${item}</li>`).join('') || '<li>Not specified</li>';
                    mealLunch.innerHTML = mealData.lunch?.map(item => `<li>${item}</li>`).join('') || '<li>Not specified</li>';
                    mealDinner.innerHTML = mealData.dinner?.map(item => `<li>${item}</li>`).join('') || '<li>Not specified</li>';
                 } else {
                     mealNoData.textContent = 'No meal plan available.';
                     mealNoData.style.display = 'block';
                 }
            }

             // Update Notifications Section UI
            async function fetchAndUpdateNotifications() {
                 if (!notificationList || !notiNoData || !notificationCountBadge) return;
                 notiNoData.style.display = 'none'; notificationList.style.display = 'none';
                 notificationList.innerHTML = '<li>Loading notifications...</li>'; notificationCountBadge.textContent = '?';
                 notificationList.style.display = 'block';

                 try {
                     await new Promise(resolve => setTimeout(resolve, 600)); // Simulate delay
                     const response = await fetch('/api/notifications');
                     if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                     const notifications = await response.json();

                     if (notifications && notifications.length > 0) {
                         notificationList.innerHTML = notifications.map(n => `<li><i class="fas ${n.type === 'medication_reminder' ? 'fa-pills' : 'fa-bell'}"></i> ${n.msg}</li>`).join('');
                         notificationCountBadge.textContent = notifications.length;
                     } else {
                         notiNoData.textContent = 'No notifications.';
                         notiNoData.style.display = 'block';
                         notificationList.style.display = 'none'; // Hide the list itself
                         notificationCountBadge.textContent = '0';
                     }
                 } catch (error) {
                     console.error("Error fetching notifications:", error);
                     notiNoData.textContent = 'Error loading notifications.';
                     notiNoData.style.display = 'block';
                     notificationList.style.display = 'none';
                     notificationCountBadge.textContent = '!';
                 }
            }


            // --- Initialization ---
            function initializeDashboard() {
                if (currentUserRole === 'caregiver') {
                    console.log("User is caregiver. Fetching patient list.");
                    if (patientListSection) patientListSection.style.display = 'block';
                    fetchAssignedPatients();
                    patientDataSections.forEach(section => section.style.display = 'none'); // Hide data until patient selected
                    if(healthPatientName) healthPatientName.textContent = "";
                    if(mealPatientName) mealPatientName.textContent = "";
                    if(notiPatientName) notiPatientName.textContent = "";
                    fetchAndUpdateNotifications(); // Fetch general/caregiver notifications

                } else if (currentUserRole === 'patient') {
                     console.log("User is patient. Hiding patient list, showing own data.");
                     if (patientListSection) patientListSection.style.display = 'none';
                     patientDataSections.forEach(section => section.style.display = 'block');
                     fetchAndDisplayPatientData(null); // Pass null to indicate self
                     fetchAndUpdateNotifications(); // Fetch patient's notifications

                } else { // Guest
                     console.log("User is guest.");
                     if (patientListSection) patientListSection.style.display = 'none';
                     patientDataSections.forEach(section => section.style.display = 'none');
                }
            }


            // --- Modal View Switching Logic ---
            if (showRegisterLink) { showRegisterLink.addEventListener('click', (e) => { e.preventDefault(); if(loginView) loginView.style.display = 'none'; if(registerView) registerView.style.display = 'block'; }); }
            if (showLoginLink) { showLoginLink.addEventListener('click', (e) => { e.preventDefault(); if(registerView) registerView.style.display = 'none'; if(loginView) loginView.style.display = 'block'; }); }

            // --- General Modal Logic ---
            const openModal = () => { if(registerView) registerView.style.display = 'none'; if(loginView) loginView.style.display = 'block'; if(authModal) authModal.style.display = 'flex'; };
            const closeModal = () => { if(authModal) authModal.style.display = 'none'; };
            if(loginBtn) loginBtn.addEventListener('click', openModal);
            if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
            window.addEventListener('click', (event) => { if (event.target === authModal) { closeModal(); } });

            // --- Form Submissions ---
            if(loginForm) { loginForm.addEventListener('submit', async (event) => { event.preventDefault();const u=document.getElementById('login-username').value;const p=document.getElementById('login-password').value;const fd=new FormData();fd.append('username',u);fd.append('password',p);console.log("Sending login...");try{const r=await fetch('/login',{method:'POST',body:fd});const d=await r.json();console.log("Login Resp:",d);if(d.status==='success'){window.location.reload();}else{alert(`Login Failed: ${d.message}`);}}catch(e){console.error('Login Err:',e);alert('Login connection error.');}}); }
            if (registerForm) { registerForm.addEventListener('submit', async (event) => { event.preventDefault();const u=document.getElementById('register-username').value;const p=document.getElementById('register-password').value;const r=document.getElementById('register-role').value;const fd=new FormData();fd.append('username',u);fd.append('password',p);fd.append('role',r);console.log("Sending registration...");try{const re=await fetch('/register',{method:'POST',body:fd});const d=await re.json();console.log("Register Resp:",d);alert(`Registration: ${d.message}`);if(d.status==='success'){if(registerView)registerView.style.display='none';if(loginView)loginView.style.display='block';}}catch(e){console.error('Register Err:',e);alert('Register connection error.');}}); }

            // --- Health Record Form Submission ---
            if(healthRecordForm) {
                healthRecordForm.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    const formData = new FormData(healthRecordForm);
                    // If caregiver is logged in AND a patient is selected, add patient_id
                    if (currentUserRole === 'caregiver' && currentPatientId) {
                        formData.append('patient_id', currentPatientId);
                        console.log(`Adding patient_id ${currentPatientId} to health record form data.`);
                    } else if (currentUserRole === 'caregiver' && !currentPatientId) {
                        alert("Please select a patient before saving a health reading.");
                        return; // Stop submission if caregiver hasn't selected a patient
                    }
                    const statusP = healthRecordStatus;

                    if (statusP) statusP.textContent = 'Saving...';
                    console.log("Sending health record data...");

                    try {
                        const response = await fetch('/api/health-records', {
                            method: 'POST',
                            body: formData
                        });
                        const result = await response.json();
                        console.log("Health Record Response:", result);

                        if (result.status === 'success') {
                            if (statusP) { statusP.textContent = `Success: ${result.message}`; statusP.style.color = 'green'; }
                            healthRecordForm.reset();
                            // Refresh data for the current view
                            fetchAndDisplayPatientData(currentPatientId); // Re-fetch data for current patient (or self if patient)
                        } else {
                             if (statusP) { statusP.textContent = `Error: ${result.message}`; statusP.style.color = 'red'; }
                        }
                    } catch (error) {
                        console.error('Error saving health record:', error);
                         if (statusP) { statusP.textContent = 'Error connecting to server.'; statusP.style.color = 'red'; }
                    } finally {
                        setTimeout(() => { if (statusP) statusP.textContent = ''; }, 5000);
                    }
                });
            } else { console.log("Health Record Form not found"); }


             // --- Initialize Dashboard View ---
             if (loggedInUsername) { initializeDashboard(); }
             else { if (patientListSection) patientListSection.style.display = 'none'; patientDataSections.forEach(section => section.style.display = 'none'); console.log("User not logged in."); }

        });
    </script>

</body>
</html>
